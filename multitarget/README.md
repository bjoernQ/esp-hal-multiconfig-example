# Multi config / multi target example

If you just need a different set of configs targeting the same chip see the "multiconfig" example for an easier approach.

This is based on a project generated by [esp-generate](https://github.com/esp-rs/esp-generate) and extends the generated project to target different chips
(and architectures) and different project configurations.

## rust-toolchain.toml

Since this example targets RISC-V and Xtensa architectures as well it's using the `esp` toolchain for both.

## Cargo.toml

Instead of specifying the target chip on the dependencies itself this is using features for each chip/config.

## main.rs

If needed we can use conditional compilation to tailor the code to the needs of a specific chip or configuration.

## .vscode/settings.json (Optional, depends on the IDE used)

This needs to select the right feature(s) and set the correct target.

It also sets `rust-analyzer.cargo.extraArgs` to include the corresponding configuration but this is not required since configs don't change the API.

It's convenient to have a `settings_XXX.json` for each configuration and just copy it as `settings.json`.

For other IDEs similar techniques might be possible.

## .cargo

The regular `config.toml` now includes aliases for the different configurations. (e.g. `esp32c6`,`esp32` etc.).
This is just for convenience - otherwise the user would need to remember to pass the correct parameters to Cargo.

Besides the correct target and features it will choose an individual `config_XXX.toml` which augments the configuration with specific settings.

Cargo will merge the base `config.toml` and the individual configs. (see https://doc.rust-lang.org/cargo/reference/config.html#hierarchical-structure and https://doc.rust-lang.org/cargo/reference/config.html#command-line-overrides)

To avoid confusion it's best to keep the whole `[env]` section in the individual config files.

This is especially true when using the esp-config TUI application to modify configs but also generally requires less reasoning about where a setting comes from.
